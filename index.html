<!DOCTYPE html>
<html lang="en">
<head>

</head>
<body style="font-size: 14pt;">
</body>
<script type="text/javascript">
    let institutes = {
    "AEST": {
        "name": "Академия экосоциальных технологий",
        "site": "www.ast.social",
    },
    'IN': {
        "name": "Института нравственности",
        "site": "www.in.ast.social",
    },
    'INP': {
        "name": "Институт нравственной политики",
        "site": "www.is.ast.social",
    },
    'IEST': {
        "name": "Институт экосоциальных технологий",
        "site": "www.ist.ast.social",
    },
    'IIM': {
        "name": "Институт интегративной медицины",
        "site": "www.iim.ast.social",
    },
    'IPTPUS': {
        "name": "Институт проблем подготовки и профессионального использования специалистов",
        "site": "www.ips.ast.social",
    },
    'IRIY': {
        "name": "Институт недвижимости и информальной юстиции",
        "site": "www.ino.ast.social",
    },
    'IMHT': {
        "name": "Институт военно-гуманитарных технологий",
        "site": "www.ivgt.ast.social",
    },
    'IPA': {
        "name": "Институт государственного управления",
        "site": "www.igumt.ast.social",
    },
    'IP': {
        "name": "Институт философии",
        "site": "www.fig.ast.social",
    },
    'IIPIY': {
        "name": "Институт международных отношений и информальной юстиции",
        "site": "www.feih.ast.social",
    },
    'IIP': {
        "name": "Институт индивидуальной педагогики",
        "site": "www.rpi.ast.social",
    },
    'IPIY': {
        "name": "Институт психологии и информальной юстиции",
        "site": "www.pi.ast.social",
    },
    'IMIY': {
        "name": "Институт медицины и информальной юстиции",
        "site": "www.mi.ast.social",
    },
    'IS': {
        "name": "Институт суицидологии",
        "site": "www.ins.ast.social",
    },
    'IPSIY': {
        "name": "Институт психиатрии и информальной юстиции",
        "site": "www.pik.ast.social",
    },
    'MIMB': {
        "name": "Военный институт маршала Бирюзова",
        "site": "www.imi.ast.social",
    },
    'SI': {
        "name": "Космический институт",
        "site": "www.kik.ast.social",
    },
    'IIY': {
        "name": "Институт информальной юстиции",
        "site": "www.uigk.ast.social",
    },
    'ICVR': {
        "name": "Институт культурных ценностей и ресурсов",
        "site": "www.icach.ast.social",
    },
    'ISU': {
        "name": "Институт субъектологии",
        "site": "www.iki.ast.social",
    },
    'IISIJ': {
        "name": "Институт международной безопасности и информальной юстиции",
        "site": "www.sis.ast.social",
    },
    'INC': {
        "name": "Институт нравственной культуры",
        "site": "www.iov.ast.social",
    },
    'SCHHST': {
        "name": "Научный консорциум высоких гуманитарных и социальных технологий",
        "site": "www.sci.ast.social",
    },
    'PPC "Anticriminal"': {
        "name": "Частная полицейская компания «Антикриминал»",
        "site": "www.ppc.ast.social",
    },
    'PMC "InfoWar"': {
        "name": "Частная военная компания «InfoWar»",
        "site": "www.pwc.ast.social",
    },
    'IAIJ': {
        "name": "Международное агентство информальной юстиции",
        "site": "www.iiya.ast.social",
    },
    'ISB': {
        "name": "Международное социальное бюро",
        "site": "www.globalnrav.ast.social",
    },
    'SAS': {
        "name": "Общество ингерманландских финнов «Финский мост времени»",
        "site": "www.suomiinkeri.ast.social",
    },
    'NS': {
        "name": "Международное движение добровольцев нравственного пути «Нравственная солидарность»",
        "site": "www.is.ast.social/menu-sotsialisticheskij-internatsional",
    },
}

function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}
function parseJwt (token) {
    var base64Url = token.split('.')[0];
    var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    return JSON.parse(jsonPayload.replace('"', '').replace(/'+/g, '"'));
}
if (typeof getParameterByName('tkn') !== "undefined") {
    try {
        let data = parseJwt(getParameterByName('tkn'))
        console.log(data)
        document.body.onload = addElement(data);
        var my_div = newDiv = null;

        function addElement(data) {
            const h = "<p><strong>Документ № " + data[4] + " подтвержден!<strong></p>"
            const name = "<p>На имя: "+data[0]+"</p>"
            const assignee = "<p>Подписан: "+data[1]+"</p>"
            const date = "<p>Дата выдачи: "+data[2]+"</p>"
            const institute = "<p><strong>"+ institutes[data[3]]['name'] +"<strong></p>"
            const site = "<a " + "href=https://" + institutes[data[3]]['site'] +">" + institutes[data[3]]['site'] + ""

            var newDiv = document.createElement("div");
            newDiv.style = "position: absolute;\n" +
              "    top: 50%;\n" +
              "    left: 50%;\n" +
              "    transform: translate(-50%, -50%);\n" +
              "    background-color: #aeecc3;\n" +
              "    padding: 25px 30px;\n" +
              "    border-radius: 10px;\n" +
              "    -webkit-box-sizing: border-box;\n" +
              "    -moz-box-sizing: border-box;\n" +
              "    box-sizing: border-box;\n" +
              "    width: 100%;\n" +
              "    max-width: 500px;"
            newDiv.innerHTML = h
            newDiv.innerHTML += name + assignee + date
            newDiv.innerHTML += institute
            newDiv.innerHTML += site


            my_div = document.getElementById("org_div1");
            document.body.insertBefore(newDiv, my_div);
        }
    } catch (error) {
        console.log(error);
        console.log(e.stack);
        console.error(e, e.stack);
        alert(error)
        document.body.onload = addElement;
        var my_div = newDiv = null;

        function addElement() {
            const h = "<p><strong>Нам не удалось подтвердить подлинность документа!<strong></p>"
            const e = "<p>" + error + "</p>"

            var newDiv = document.createElement("div");
            newDiv.style = "position: absolute;\n" +
                "    top: 50%;\n" +
                "    left: 50%;\n" +
                "    transform: translate(-50%, -50%);\n" +
                "    background-color: rgb(255 201 219);;\n" +
                "    padding: 25px 30px;\n" +
                "    border-radius: 10px;\n" +
                "    -webkit-box-sizing: border-box;\n" +
                "    -moz-box-sizing: border-box;\n" +
                "    box-sizing: border-box;\n" +
                "    width: 100%;\n" +
                "    max-width: 500px;"
            newDiv.innerHTML = h
            newDiv.innerHTML += e
            

            my_div = document.getElementById("org_div1");
            document.body.insertBefore(newDiv, my_div);
        }
    }
}

</script>

</html>
